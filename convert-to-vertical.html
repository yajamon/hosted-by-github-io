<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>縦書きジェネレーター</title>
        <style>
body {
    background-color: lightgray;
}
textarea {
    font-family: monospace;
}
        </style>
    </head>
    <body>
        <div>
            <textarea id="in" cols="50" rows="6"></textarea>
        </div>
        <div>
            <button id="convert_button">変換</button>
        </div>
        <div>
            <textarea id="out" cols="12" rows="25"></textarea>
        </div>
        <script>
            /**
             * @param {string} s
             * @return {string}
             */
            const trimEachLine = (s) => {
                return s.split("\n")
                    .map( (line) => line.trimEnd() )
                    .join("\n");
            }

            /**
             * @param {string} s
             * @return {string}
             */
            const swapAxis = (s) => {
                const sp = "　";
                const chars = s.split("\n").map((l) => l.split("")).reverse();
                const new_w = chars.length;
                const new_h = chars.reduce((max, line) => max < line.length ? line.length : max, 0);

                let graph = Array(new_h);
                for(let row = 0; row < new_h; row += 1) {
                    graph[row] = Array(new_w);
                    for(let col = 0; col < new_w; col += 1) {
                        graph[row][col] = chars[col][row] || sp;
                    }
                }

                return graph.map((l) => l.join("")).join("\n");
            };

            const convert_button = document.getElementById("convert_button");
            convert_button.addEventListener("click", () => {
                const in_textarea = document.getElementById("in");
                const out_textarea = document.getElementById("out");

                let filters = [];
                filters.push(swapAxis);
                filters.push(trimEachLine);

                let filtered = filters.reduce((s, filter) => filter(s), in_textarea.value);
                out_textarea.value = filtered;
                console.log("convert");
            });
        </script>
    </body>
</html>
